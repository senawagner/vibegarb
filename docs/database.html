<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Dados - Vibe Garb E-commerce</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>📚 Documentação</h2>
                <p>Vibe Garb E-commerce</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="index.html">🏠 Início</a></li>
                    <li><a href="architecture.html">🏗️ Arquitetura</a></li>
                    <li><a href="database.html" class="active">🗄️ Banco de Dados</a></li>
                    <li><a href="development.html">🚀 Desenvolvimento</a></li>
                    <li><a href="build.html">🔨 Sistema de Build</a></li>
                    <li><a href="checkout-implementation.html">💳 Checkout</a></li>
                    <li><a href="current-status.html">📊 Status Atual</a></li>
                    <li><a href="mvp-plan.html">📋 Plano MVP</a></li>
                    <li><a href="mvp-migrations.html">🔧 Migrações MVP</a></li>
                    <li><a href="troubleshooting.html">🛠️ Troubleshooting</a></li>
                    <li><a href="session-implementations.html">📝 Implementações</a></li>
                    <li><a href="dropshipping-model.html">📦 Modelo Dropshipping</a></li>
                    <li><a href="git-workflow.html">🔄 Git Workflow</a></li>
                    <li><a href="safe-development.html">🛡️ Desenvolvimento Seguro</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>🗄️ Banco de Dados</h1>
                <p class="subtitle">Estrutura completa do banco de dados MySQL 8.0 do Vibe Garb E-commerce. Este documento detalha todas as tabelas, campos, relacionamentos, índices e constraints implementados. Inclui a modelagem de dados otimizada para dropshipping, estrutura de produtos com variações, sistema de pedidos e painel administrativo completo. Essencial para desenvolvedores que precisam entender a arquitetura de dados do sistema.</p>
                <p class="date">Atualizado: 07/07/2025 - Estrutura Real v1.0.0</p>
            </header>

            <div class="content-grid">
                <!-- Visão Geral -->
                <div class="card">
                    <h2>📊 Visão Geral do Banco</h2>
                    <p><strong>Sistema:</strong> MySQL 8.0 com InnoDB</p>
                    <p><strong>Database:</strong> vibegarb</p>
                    <p><strong>Charset:</strong> utf8mb4_unicode_ci</p>
                    <p><strong>Migrations:</strong> 24 migrations aplicadas</p>
                    
                    <h3>Estatísticas Atuais</h3>
                    <div class="data-grid">
                        <div class="data-item">
                            <strong>15+ tabelas</strong> implementadas
                        </div>
                        <div class="data-item">
                            <strong>13 models</strong> Eloquent
                        </div>
                        <div class="data-item">
                            <strong>7 produtos</strong> cadastrados
                        </div>
                        <div class="data-item">
                            <strong>34 variações</strong> de produtos
                        </div>
                        <div class="data-item">
                            <strong>6 categorias</strong> organizadas
                        </div>
                        <div class="data-item">
                            <strong>4 fornecedores</strong> dropshipping
                        </div>
                    </div>
                </div>

                <!-- Estrutura de Tabelas -->
                <div class="card card-full">
                    <h2>🗂️ Estrutura de Tabelas</h2>

                    <h3>📋 Tabelas Principais</h3>
                    <div class="table-list">
                        <div class="table-item">
                            <strong>users</strong> - Usuários (clientes e administradores)
                        </div>
                        <div class="table-item">
                            <strong>categories</strong> - Categorias de produtos
                        </div>
                        <div class="table-item">
                            <strong>suppliers</strong> - Fornecedores para dropshipping
                        </div>
                        <div class="table-item">
                            <strong>products</strong> - Produtos do catálogo
                        </div>
                        <div class="table-item">
                            <strong>product_images</strong> - Imagens dos produtos
                        </div>
                        <div class="table-item">
                            <strong>product_variants</strong> - Variações de produtos (cor/tamanho)
                        </div>
                        <div class="table-item">
                            <strong>product_reviews</strong> - Avaliações de produtos
                        </div>
                        <div class="table-item">
                            <strong>cart_items</strong> - Itens do carrinho
                        </div>
                        <div class="table-item">
                            <strong>orders</strong> - Pedidos dos clientes
                        </div>
                        <div class="table-item">
                            <strong>order_items</strong> - Itens dos pedidos
                        </div>
                        <div class="table-item">
                            <strong>payments</strong> - Pagamentos realizados
                        </div>
                        <div class="table-item">
                            <strong>coupons</strong> - Cupons de desconto
                        </div>
                        <div class="table-item">
                            <strong>newsletter_subscriptions</strong> - Assinantes da newsletter
                        </div>
                    </div>

                    <h3>🔧 Tabelas do Sistema</h3>
                    <div class="table-list">
                        <div class="table-item">
                            <strong>cache</strong> - Cache do Laravel
                        </div>
                        <div class="table-item">
                            <strong>jobs</strong> - Queue jobs
                        </div>
                        <div class="table-item">
                            <strong>migrations</strong> - Controle de migrations
                        </div>
                    </div>
                </div>

                <!-- Detalhamento das Tabelas -->
                <div class="card card-full">
                    <h2>📝 Detalhamento das Tabelas</h2>

                    <!-- Users -->
                    <div class="table-detail">
                        <h3>👤 users</h3>
                        <div class="table-info">
                            <p><strong>Função:</strong> Armazena dados de usuários, clientes e administradores</p>
                            <p><strong>Modelo:</strong> App\Models\User</p>
                        </div>
                        <div class="fields-grid">
                            <div class="field-group">
                                <h4>Campos Básicos</h4>
                                <ul>
                                    <li><code>id</code> - bigint (PK)</li>
                                    <li><code>name</code> - varchar(255)</li>
                                    <li><code>email</code> - varchar(255) unique</li>
                                    <li><code>email_verified_at</code> - timestamp</li>
                                    <li><code>password</code> - varchar(255)</li>
                                    <li><code>remember_token</code> - varchar(100)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Campos E-commerce</h4>
                                <ul>
                                    <li><code>phone</code> - varchar(20)</li>
                                    <li><code>birth_date</code> - date</li>
                                    <li><code>document</code> - varchar(20)</li>
                                    <li><code>gender</code> - enum('M','F','other')</li>
                                    <li><code>is_admin</code> - boolean</li>
                                    <li><code>status</code> - enum('active','inactive','banned')</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Endereços</h4>
                                <ul>
                                    <li><code>address</code> - varchar(255)</li>
                                    <li><code>address_number</code> - varchar(10)</li>
                                    <li><code>address_complement</code> - varchar(100)</li>
                                    <li><code>neighborhood</code> - varchar(100)</li>
                                    <li><code>city</code> - varchar(100)</li>
                                    <li><code>state</code> - varchar(2)</li>
                                    <li><code>zipcode</code> - varchar(10)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Products -->
                    <div class="table-detail">
                        <h3>🛍️ products</h3>
                        <div class="table-info">
                            <p><strong>Função:</strong> Catálogo completo de produtos com informações para dropshipping</p>
                            <p><strong>Modelo:</strong> App\Models\Product</p>
                        </div>
                        <div class="fields-grid">
                            <div class="field-group">
                                <h4>Identificação</h4>
                                <ul>
                                    <li><code>id</code> - bigint (PK)</li>
                                    <li><code>name</code> - varchar(255)</li>
                                    <li><code>slug</code> - varchar(255) unique</li>
                                    <li><code>sku</code> - varchar(100) unique</li>
                                    <li><code>category_id</code> - bigint (FK)</li>
                                    <li><code>supplier_id</code> - bigint (FK)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Conteúdo</h4>
                                <ul>
                                    <li><code>description</code> - text</li>
                                    <li><code>short_description</code> - varchar(500)</li>
                                    <li><code>images</code> - json</li>
                                    <li><code>attributes</code> - json</li>
                                    <li><code>meta_title</code> - varchar(255)</li>
                                    <li><code>meta_description</code> - text</li>
                                    <li><code>meta_keywords</code> - varchar(255)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Preços e Produção</h4>
                                <ul>
                                    <li><code>price</code> - decimal(10,2)</li>
                                    <li><code>sale_price</code> - decimal(10,2)</li>
                                    <li><code>cost_price</code> - decimal(10,2)</li>
                                    <li><code>production_days</code> - int</li>
                                    <li><code>weight</code> - decimal(8,2)</li>
                                    <li><code>dimensions</code> - varchar(100)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Dropshipping</h4>
                                <ul>
                                    <li><code>quality_line</code> - enum('classic','quality','prime','pima','estonada','dry_sport')</li>
                                    <li><code>target_audience</code> - enum('masculino','feminino','infantil','unissex')</li>
                                    <li><code>available_colors</code> - text</li>
                                    <li><code>available_sizes</code> - text</li>
                                    <li><code>stock_quantity</code> - int (sempre 0 para dropshipping)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Status e Flags</h4>
                                <ul>
                                    <li><code>is_active</code> - boolean</li>
                                    <li><code>is_featured</code> - boolean</li>
                                    <li><code>featured</code> - boolean</li>
                                    <li><code>active</code> - boolean</li>
                                    <li><code>created_at</code> - timestamp</li>
                                    <li><code>updated_at</code> - timestamp</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Orders -->
                    <div class="table-detail">
                        <h3>📦 orders</h3>
                        <div class="table-info">
                            <p><strong>Função:</strong> Pedidos dos clientes com suporte a checkout anônimo</p>
                            <p><strong>Modelo:</strong> App\Models\Order</p>
                        </div>
                        <div class="fields-grid">
                            <div class="field-group">
                                <h4>Identificação</h4>
                                <ul>
                                    <li><code>id</code> - bigint (PK)</li>
                                    <li><code>order_number</code> - varchar(100) unique</li>
                                    <li><code>user_id</code> - bigint nullable (FK)</li>
                                    <li><code>status</code> - enum('pending','confirmed','processing','shipped','delivered','cancelled')</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Dados do Cliente</h4>
                                <ul>
                                    <li><code>customer_name</code> - varchar(255)</li>
                                    <li><code>customer_email</code> - varchar(255)</li>
                                    <li><code>customer_phone</code> - varchar(20)</li>
                                    <li><code>customer_document</code> - varchar(20)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Endereço de Entrega</h4>
                                <ul>
                                    <li><code>shipping_address</code> - varchar(255)</li>
                                    <li><code>shipping_number</code> - varchar(10)</li>
                                    <li><code>shipping_complement</code> - varchar(100)</li>
                                    <li><code>shipping_neighborhood</code> - varchar(100)</li>
                                    <li><code>shipping_city</code> - varchar(100)</li>
                                    <li><code>shipping_state</code> - varchar(2)</li>
                                    <li><code>shipping_zipcode</code> - varchar(10)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Valores e Pagamento</h4>
                                <ul>
                                    <li><code>subtotal</code> - decimal(10,2)</li>
                                    <li><code>shipping_cost</code> - decimal(10,2)</li>
                                    <li><code>discount_amount</code> - decimal(10,2)</li>
                                    <li><code>total_amount</code> - decimal(10,2)</li>
                                    <li><code>payment_method</code> - enum('pix','boleto','credit_card')</li>
                                    <li><code>payment_status</code> - enum('pending','paid','failed','cancelled')</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Dropshipping</h4>
                                <ul>
                                    <li><code>dropshipping_status</code> - enum('pending','sent_to_production','in_production','shipped','delivered')</li>
                                    <li><code>production_order_id</code> - varchar(100)</li>
                                    <li><code>supplier_order_id</code> - varchar(100)</li>
                                    <li><code>tracking_code</code> - varchar(100)</li>
                                    <li><code>estimated_delivery</code> - date</li>
                                    <li><code>supplier_notes</code> - text</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Product Variants -->
                    <div class="table-detail">
                        <h3>🎨 product_variants</h3>
                        <div class="table-info">
                            <p><strong>Função:</strong> Variações de produtos (cor, tamanho, preços adicionais)</p>
                            <p><strong>Modelo:</strong> App\Models\ProductVariant</p>
                        </div>
                        <div class="fields-grid">
                            <div class="field-group">
                                <h4>Relacionamento</h4>
                                <ul>
                                    <li><code>id</code> - bigint (PK)</li>
                                    <li><code>product_id</code> - bigint (FK)</li>
                                </ul>
                            </div>
                            <div class="field-group">
                                <h4>Variações</h4>
                                <ul>
                                    <li><code>size</code> - varchar(10)</li>
                                    <li><code>color</code> - varchar(50)</li>
                                    <li><code>additional_price</code> - decimal(8,2)</li>
                                    <li><code>is_available</code> - boolean</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Relacionamentos -->
                <div class="card card-full">
                    <h2>🔗 Relacionamentos do Banco</h2>

                    <h3>Relacionamentos Principais</h3>
                    <div class="relationship-grid">
                        <div class="relationship-item">
                            <h4>👤 Users → Orders</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> orders.user_id → users.id (nullable)</p>
                            <p><strong>Constraint:</strong> ON DELETE SET NULL</p>
                        </div>

                        <div class="relationship-item">
                            <h4>📂 Categories → Products</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> products.category_id → categories.id</p>
                            <p><strong>Constraint:</strong> ON DELETE CASCADE</p>
                        </div>

                        <div class="relationship-item">
                            <h4>🏭 Suppliers → Products</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> products.supplier_id → suppliers.id</p>
                            <p><strong>Constraint:</strong> ON DELETE RESTRICT</p>
                        </div>

                        <div class="relationship-item">
                            <h4>🛍️ Products → Product Images</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> product_images.product_id → products.id</p>
                            <p><strong>Constraint:</strong> ON DELETE CASCADE</p>
                        </div>

                        <div class="relationship-item">
                            <h4>🛍️ Products → Product Variants</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> product_variants.product_id → products.id</p>
                            <p><strong>Constraint:</strong> ON DELETE CASCADE</p>
                        </div>

                        <div class="relationship-item">
                            <h4>📦 Orders → Order Items</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> order_items.order_id → orders.id</p>
                            <p><strong>Constraint:</strong> ON DELETE CASCADE</p>
                        </div>

                        <div class="relationship-item">
                            <h4>🛍️ Products → Order Items</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> order_items.product_id → products.id</p>
                            <p><strong>Constraint:</strong> ON DELETE RESTRICT</p>
                        </div>

                        <div class="relationship-item">
                            <h4>📦 Orders → Payments</h4>
                            <p><strong>Tipo:</strong> One to Many (1:N)</p>
                            <p><strong>FK:</strong> payments.order_id → orders.id</p>
                            <p><strong>Constraint:</strong> ON DELETE CASCADE</p>
                        </div>
                    </div>
                </div>

                <!-- Índices e Performance -->
                <div class="card">
                    <h2>⚡ Índices e Performance</h2>

                    <h3>Índices Principais</h3>
                    <div class="index-list">
                        <div class="index-item">
                            <strong>users_email_unique</strong> - users(email)
                        </div>
                        <div class="index-item">
                            <strong>products_slug_unique</strong> - products(slug)
                        </div>
                        <div class="index-item">
                            <strong>products_sku_unique</strong> - products(sku)
                        </div>
                        <div class="index-item">
                            <strong>orders_order_number_unique</strong> - orders(order_number)
                        </div>
                        <div class="index-item">
                            <strong>idx_products_active</strong> - products(is_active)
                        </div>
                        <div class="index-item">
                            <strong>idx_products_category</strong> - products(category_id)
                        </div>
                        <div class="index-item">
                            <strong>idx_orders_status</strong> - orders(status)
                        </div>
                        <div class="index-item">
                            <strong>idx_orders_user</strong> - orders(user_id)
                        </div>
                    </div>

                    <h3>Otimizações Implementadas</h3>
                    <ul>
                        <li>✅ <strong>Eager Loading:</strong> Relacionamentos carregados com with()</li>
                        <li>✅ <strong>Índices em FKs:</strong> Todas as foreign keys indexadas</li>
                        <li>✅ <strong>Campos Únicos:</strong> email, slug, sku, order_number</li>
                        <li>✅ <strong>Campos JSON:</strong> Para dados flexíveis (images, attributes)</li>
                        <li>✅ <strong>Campos Decimais:</strong> Precisão monetária garantida</li>
                        <li>✅ <strong>Campos Nullable:</strong> user_id para checkout anônimo</li>
                    </ul>
                </div>

                <!-- Migrations Aplicadas -->
                <div class="card">
                    <h2>📋 Migrations Aplicadas</h2>

                    <h3>Ordem de Execução</h3>
                    <div class="migration-list">
                        <div class="migration-item">
                            <code>0001_01_01_000000_create_users_table</code>
                        </div>
                        <div class="migration-item">
                            <code>0001_01_01_000001_create_cache_table</code>
                        </div>
                        <div class="migration-item">
                            <code>0001_01_01_000002_create_jobs_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_051656_create_categories_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_051801_create_suppliers_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_051839_create_products_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_052001_create_product_images_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_052424_create_product_variants_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_052539_create_coupons_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_052540_create_orders_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_052710_create_order_items_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_052746_create_payments_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_053358_create_newsletter_subscriptions_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_053705_create_product_reviews_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_053947_update_users_table_add_ecommerce_fields</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_27_074138_create_cart_items_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_06_29_153728_add_quality_line_to_products_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_07_03_180640_add_checkout_fields_to_orders_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_07_03_195942_add_dropshipping_fields_to_orders_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_07_05_023143_add_display_order_to_categories_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_07_05_114448_change_status_column_in_orders_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_07_05_154506_change_status_column_in_orders_table_v2</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_07_05_200515_add_supplier_fields_to_orders_table</code>
                        </div>
                        <div class="migration-item">
                            <code>2025_07_07_032019_make_user_id_nullable_in_orders_table</code>
                        </div>
                    </div>
                </div>

                <!-- Comandos Úteis -->
                <div class="card">
                    <h2>⚡ Comandos Úteis</h2>

                    <h3>Migrations</h3>
                    <div class="code-block">
                        <pre><code># Verificar status das migrations
php artisan migrate:status

# Executar migrations pendentes
php artisan migrate

# Rollback última migration
php artisan migrate:rollback

# Criar nova migration
php artisan make:migration create_nova_tabela</code></pre>
                    </div>

                    <h3>Banco de Dados</h3>
                    <div class="code-block">
                        <pre><code># Acessar MySQL via Docker
docker-compose exec db mysql -u root -p

# Backup do banco
docker-compose exec db mysqldump -u root -p vibegarb > backup.sql

# Restaurar backup
docker-compose exec -T db mysql -u root -p vibegarb < backup.sql

# Verificar conexão
php artisan tinker
>>> DB::connection()->getPdo();</code></pre>
                    </div>

                    <h3>Dados de Teste</h3>
                    <div class="code-block">
                        <pre><code># Executar seeders
php artisan db:seed

# Seeder específico
php artisan db:seed --class=ProductSeeder

# Resetar banco com seeders
php artisan migrate:fresh --seed</code></pre>
                    </div>
                </div>

                <!-- Considerações para Produção -->
                <div class="card conclusion">
                    <h2>🚀 Considerações para Produção</h2>
                    
                    <h3>✅ Otimizações Implementadas</h3>
                    <ul>
                        <li>✅ <strong>Índices Estratégicos:</strong> Em campos de busca e relacionamentos</li>
                        <li>✅ <strong>Constraints Adequadas:</strong> Integridade referencial garantida</li>
                        <li>✅ <strong>Campos Nullable:</strong> Flexibilidade para checkout anônimo</li>
                        <li>✅ <strong>Tipos Apropriados:</strong> Decimais para valores monetários</li>
                        <li>✅ <strong>JSON para Flexibilidade:</strong> Images e attributes</li>
                        <li>✅ <strong>Enums para Consistência:</strong> Status e tipos bem definidos</li>
                    </ul>

                    <h3>🔧 Próximas Otimizações</h3>
                    <ul>
                        <li>🎯 <strong>Particionamento:</strong> Para tabelas com grande volume</li>
                        <li>🎯 <strong>Read Replicas:</strong> Para consultas de alto volume</li>
                        <li>🎯 <strong>Cache de Query:</strong> Redis para consultas frequentes</li>
                        <li>🎯 <strong>Índices Compostos:</strong> Para queries complexas específicas</li>
                    </ul>

                    <h3>📊 Status Atual</h3>
                    <p><strong>🟢 BANCO OTIMIZADO:</strong> Estrutura completamente funcional e otimizada para dropshipping e e-commerce.</p>
                    <p><strong>🎯 PRONTO PARA ESCALA:</strong> Arquitetura preparada para crescimento e alto volume de transações.</p>
                    <p><strong>🚀 PRODUÇÃO READY:</strong> Database pronto para ambiente de produção cPanel.</p>
                </div>
            </div>
        </main>
    </div>
</body>
</html> 