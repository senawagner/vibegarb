<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajustes de Migração para MVP Dropshipping - Vibe Garb</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>📚 Documentação</h2>
                <p>Vibe Garb E-commerce</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="index.html">🏠 Início</a></li>
                    <li><a href="architecture.html">🏗️ Arquitetura</a></li>
                    <li><a href="database.html">🗄️ Banco de Dados</a></li>
                    <li><a href="development.html">🚀 Desenvolvimento</a></li>
                    <li><a href="build.html">🔨 Sistema de Build</a></li>
                    <li><a href="checkout-implementation.html">💳 Checkout</a></li>
                    <li><a href="current-status.html">📊 Status Atual</a></li>
                    <li><a href="phase2-completion.html">✅ Fase 2</a></li>
                    <li><a href="mvp-plan.html">📋 Plano MVP</a></li>
                    <li><a href="mvp-migrations.html" class="active">🔧 Migrações MVP</a></li>
                    <li><a href="troubleshooting.html">🛠️ Troubleshooting</a></li>
                    <li><a href="dropshipping-model.html">📦 Modelo Dropshipping</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>🔧 Ajustes de Migração para MVP Dropshipping</h1>
                <p class="subtitle">Modificações necessárias para otimizar a estrutura atual</p>
            </header>

            <div class="content-grid">
                <!-- Objetivo -->
                <div class="card">
                    <h2>📋 Modificações Necessárias</h2>
                    
                    <h3>🎯 Objetivo</h3>
                    <p>Ajustar a estrutura atual de banco para o modelo de dropshipping simplificado, sem gestão de estoque físico e com foco em variedades de produtos.</p>
                </div>

                <!-- Alterações no Banco de Dados -->
                <div class="card">
                    <h2>🗄️ Alterações no Banco de Dados</h2>
                    
                    <h3>1. Tabela `products` - Ajustes Principais</h3>
                    
                    <h4>Migration: Adicionar Linha de Qualidade</h4>
                    <div class="code-block">
                        <pre><code>&lt;?php
// database/migrations/2025_01_XX_add_quality_line_to_products.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class AddQualityLineToProducts extends Migration
{
    public function up()
    {
        Schema::table('products', function (Blueprint $table) {
            // Adicionar linha de qualidade
            $table->enum('quality_line', [
                'classic', 'quality', 'prime', 'pima', 'estonada', 'dry_sport'
            ])->default('classic')->after('category_id');
            
            // Adicionar público alvo
            $table->enum('target_audience', [
                'masculino', 'feminino', 'infantil', 'unissex'
            ])->default('unissex')->after('quality_line');
            
            // Adicionar cores disponíveis
            $table->json('available_colors')->nullable()->after('target_audience');
            
            // Adicionar tamanhos disponíveis  
            $table->json('available_sizes')->nullable()->after('available_colors');
            
            // Adicionar tabela de medidas
            $table->json('size_chart')->nullable()->after('available_sizes');
            
            // Remover campos desnecessários para dropshipping
            $table->dropColumn(['stock_quantity', 'manage_stock', 'supplier_id']);
        });
    }

    public function down()
    {
        Schema::table('products', function (Blueprint $table) {
            $table->dropColumn([
                'quality_line', 'target_audience', 'available_colors', 
                'available_sizes', 'size_chart'
            ]);
            
            $table->integer('stock_quantity')->default(0);
            $table->boolean('manage_stock')->default(true);
            $table->foreignId('supplier_id')->nullable()->constrained();
        });
    }
}</code></pre>
                    </div>

                    <h3>2. Tabela `categories` - Simplificar para MVP</h3>
                    
                    <h4>Migration: Ajustar Categorias</h4>
                    <div class="code-block">
                        <pre><code>&lt;?php
// database/migrations/2025_01_XX_update_categories_for_mvp.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class UpdateCategoriesForMvp extends Migration
{
    public function up()
    {
        Schema::table('categories', function (Blueprint $table) {
            // Adicionar ícone para a categoria
            $table->string('icon')->nullable()->after('description');
            
            // Adicionar ordem de exibição
            $table->integer('sort_order')->default(0)->after('icon');
        });
    }

    public function down()
    {
        Schema::table('categories', function (Blueprint $table) {
            $table->dropColumn(['icon', 'sort_order']);
        });
    }
}</code></pre>
                    </div>

                    <h3>3. Tabela `product_variants` - Ajustar para Dropshipping</h3>
                    
                    <h4>Migration: Simplificar Variações</h4>
                    <div class="code-block">
                        <pre><code>&lt;?php
// database/migrations/2025_01_XX_update_product_variants_for_dropshipping.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class UpdateProductVariantsForDropshipping extends Migration
{
    public function up()
    {
        Schema::table('product_variants', function (Blueprint $table) {
            // Simplificar campos para dropshipping
            $table->string('size')->after('product_id');
            $table->string('color')->after('size');
            $table->decimal('additional_price', 8, 2)->default(0)->after('color');
            
            // Remover campos não necessários
            $table->dropColumn(['variant_type', 'variant_value', 'stock_quantity']);
        });
    }

    public function down()
    {
        Schema::table('product_variants', function (Blueprint $table) {
            $table->dropColumn(['size', 'color', 'additional_price']);
            
            $table->string('variant_type');
            $table->string('variant_value');
            $table->integer('stock_quantity')->default(0);
        });
    }
}</code></pre>
                    </div>

                    <h3>4. Tabela `orders` - Adicionar Campos Dropshipping</h3>
                    
                    <h4>Migration: Ajustar Pedidos para Dropshipping</h4>
                    <div class="code-block">
                        <pre><code>&lt;?php
// database/migrations/2025_01_XX_update_orders_for_dropshipping.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class UpdateOrdersForDropshipping extends Migration
{
    public function up()
    {
        Schema::table('orders', function (Blueprint $table) {
            // Status específicos para dropshipping
            $table->enum('production_status', [
                'pending', 'sent_to_factory', 'in_production', 
                'produced', 'shipped', 'delivered'
            ])->default('pending')->after('status');
            
            // Dados da fábrica
            $table->json('factory_order_data')->nullable()->after('production_status');
            
            // Custo da fábrica (para controle interno)
            $table->decimal('factory_cost', 8, 2)->nullable()->after('factory_order_data');
            
            // Margem de lucro calculada
            $table->decimal('profit_margin', 8, 2)->nullable()->after('factory_cost');
        });
    }

    public function down()
    {
        Schema::table('orders', function (Blueprint $table) {
            $table->dropColumn([
                'production_status', 'factory_order_data', 
                'factory_cost', 'profit_margin'
            ]);
        });
    }
}</code></pre>
                    </div>
                </div>

                <!-- Ajustes nos Models -->
                <div class="card">
                    <h2>🔧 Ajustes nos Models</h2>
                    
                    <h3>1. Model Product Atualizado</h3>
                    <div class="code-block">
                        <pre><code>&lt;?php
// app/Models/Product.php - Versão MVP

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class Product extends Model
{
    use HasFactory;

    protected $fillable = [
        'name', 'slug', 'description', 'short_description', 'sku',
        'price', 'sale_price', 'weight', 'dimensions',
        'is_active', 'is_featured', 'images', 'attributes',
        'category_id', 'quality_line', 'target_audience',
        'available_colors', 'available_sizes', 'size_chart'
    ];

    protected $casts = [
        'price' => 'decimal:2',
        'sale_price' => 'decimal:2', 
        'weight' => 'decimal:2',
        'is_active' => 'boolean',
        'is_featured' => 'boolean',
        'images' => 'array',
        'attributes' => 'array',
        'available_colors' => 'array',
        'available_sizes' => 'array',
        'size_chart' => 'array'
    ];

    // Relacionamentos
    public function category()
    {
        return $this->belongsTo(Category::class);
    }

    public function variants()
    {
        return $this->hasMany(ProductVariant::class);
    }

    public function orderItems()
    {
        return $this->hasMany(OrderItem::class);
    }

    public function reviews()
    {
        return $this->hasMany(ProductReview::class);
    }

    // Scopes
    public function scopeActive($query)
    {
        return $query->where('is_active', true);
    }

    public function scopeFeatured($query)
    {
        return $query->where('is_featured', true);
    }

    public function scopeByQuality($query, $quality)
    {
        return $query->where('quality_line', $quality);
    }

    public function scopeByAudience($query, $audience)
    {
        return $query->where('target_audience', $audience);
    }

    // Accessors
    public function getCurrentPriceAttribute()
    {
        return $this->sale_price ?? $this->price;
    }

    public function getFormattedPriceAttribute()
    {
        return 'R$ ' . number_format($this->current_price, 2, ',', '.');
    }

    public function getQualityDescriptionAttribute()
    {
        $descriptions = [
            'classic' => 'Linha econômica com boa qualidade',
            'quality' => 'Custo-benefício com costura reforçada',
            'prime' => 'Qualidade superior, malha pré-lavada',
            'pima' => 'Premium com algodão Pima',
            'estonada' => 'Malha com aspecto vintage',
            'dry_sport' => 'Performance para atividades físicas'
        ];

        return $descriptions[$this->quality_line] ?? '';
    }

    // Métodos específicos para dropshipping
    public function getVariantPrice($size, $color)
    {
        $variant = $this->variants()
            ->where('size', $size)
            ->where('color', $color)
            ->first();

        return $this->current_price + ($variant->additional_price ?? 0);
    }

    public function hasVariant($size, $color)
    {
        return $this->variants()
            ->where('size', $size)
            ->where('color', $color)
            ->exists();
    }
}</code></pre>
                    </div>

                    <h3>2. Model ProductVariant Simplificado</h3>
                    <div class="code-block">
                        <pre><code>&lt;?php
// app/Models/ProductVariant.php - Versão MVP

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class ProductVariant extends Model
{
    protected $fillable = [
        'product_id', 'size', 'color', 'additional_price', 'sku'
    ];

    protected $casts = [
        'additional_price' => 'decimal:2'
    ];

    public function product()
    {
        return $this->belongsTo(Product::class);
    }

    public function getFinalPriceAttribute()
    {
        return $this->product->current_price + $this->additional_price;
    }

    public function getFormattedFinalPriceAttribute()
    {
        return 'R$ ' . number_format($this->final_price, 2, ',', '.');
    }
}</code></pre>
                    </div>
                </div>

                <!-- Seeders Atualizados -->
                <div class="card">
                    <h2>🌱 Seeders Atualizados para MVP</h2>
                    
                    <h3>CategorySeeder para MVP</h3>
                    <div class="code-block">
                        <pre><code>&lt;?php
// database/seeders/CategorySeederMVP.php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Category;

class CategorySeederMVP extends Seeder
{
    public function run()
    {
        $categories = [
            [
                'name' => 'Camisetas',
                'slug' => 'camisetas',
                'description' => 'T-shirts, regatas, mangas longas e mais',
                'icon' => '👕',
                'sort_order' => 1,
                'is_active' => true
            ],
            [
                'name' => 'Moletons',
                'slug' => 'moletons',
                'description' => 'Blusões, cangurus e moletons com zíper',
                'icon' => '🧥',
                'sort_order' => 2,
                'is_active' => true
            ],
            [
                'name' => 'Plus Size',
                'slug' => 'plus-size',
                'description' => 'Tamanhos especiais para todos os tipos',
                'icon' => '👔',
                'sort_order' => 3,
                'is_active' => true
            ],
            [
                'name' => 'Infantil',
                'slug' => 'infantil',
                'description' => 'Camisetas e bodies para crianças',
                'icon' => '👶',
                'sort_order' => 4,
                'is_active' => true
            ],
            [
                'name' => 'Acessórios',
                'slug' => 'acessorios',
                'description' => 'Canecas, bolsas, bonés e mais',
                'icon' => '🎒',
                'sort_order' => 5,
                'is_active' => true
            ]
        ];

        foreach ($categories as $category) {
            Category::create($category);
        }
    }
}</code></pre>
                    </div>
                </div>

                <!-- Próximos Passos -->
                <div class="card">
                    <h2>🎯 Próximos Passos</h2>
                    
                    <h3>1. Executar Migrations</h3>
                    <div class="code-block">
                        <pre><code># Criar migrations
docker exec vibegarb_app php artisan make:migration add_quality_line_to_products
docker exec vibegarb_app php artisan make:migration update_categories_for_mvp
docker exec vibegarb_app php artisan make:migration update_product_variants_for_dropshipping
docker exec vibegarb_app php artisan make:migration update_orders_for_dropshipping

# Executar migrations
docker exec vibegarb_app php artisan migrate</code></pre>
                    </div>

                    <h3>2. Atualizar Seeders</h3>
                    <div class="code-block">
                        <pre><code># Executar novos seeders
docker exec vibegarb_app php artisan db:seed --class=CategorySeederMVP</code></pre>
                    </div>

                    <h3>3. Testar Models</h3>
                    <div class="code-block">
                        <pre><code># Testar nova estrutura
docker exec vibegarb_app php artisan tinker --execute="
\$product = App\Models\Product::create([
    'name' => 'Camiseta Tech Modal Preta',
    'quality_line' => 'prime',
    'target_audience' => 'masculino',
    'available_colors' => ['Preto', 'Branco', 'Cinza'],
    'available_sizes' => ['P', 'M', 'G', 'GG'],
    'price' => 89.90,
    'category_id' => 1
]);
echo 'Produto criado: ' . \$product->name;
"</code></pre>
                    </div>
                </div>

                <!-- Conclusão -->
                <div class="card conclusion">
                    <h2>🎯 Resultado</h2>
                    <p>Estrutura de banco otimizada para dropshipping com foco em variedade de produtos e qualidades, sem complexidade desnecessária de estoque físico.</p>
                </div>
            </div>
        </main>
    </div>

    <script src="js/main.js"></script>
</body>
</html> 