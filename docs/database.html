<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documenta√ß√£o do Banco de Dados - Vibe Garb</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üìö Documenta√ß√£o</h2>
                <p>Vibe Garb E-commerce</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="index.html">üè† In√≠cio</a></li>
                    <li><a href="architecture.html">üèóÔ∏è Arquitetura</a></li>
                    <li><a href="database.html" class="active">üóÑÔ∏è Banco de Dados</a></li>
                    <li><a href="development.html">üöÄ Desenvolvimento</a></li>
                    <li><a href="build.html">üî® Sistema de Build</a></li>
                    <li><a href="checkout-implementation.html">üí≥ Checkout</a></li>
                    <li><a href="current-status.html">üìä Status Atual</a></li>
                    <li><a href="mvp-plan.html">üìã Plano MVP</a></li>
                    <li><a href="mvp-migrations.html">üîß Migra√ß√µes MVP</a></li>
                    <li><a href="troubleshooting.html">üõ†Ô∏è Troubleshooting</a></li>
                    <li><a href="dropshipping-model.html">üì¶ Modelo Dropshipping</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>üóÑÔ∏è Documenta√ß√£o do Banco de Dados - Vibe Garb</h1>
                <p class="subtitle">Estrutura completa e relacionamentos implementados</p>
            </header>

            <div class="content-grid">
                <!-- Vis√£o Geral -->
                <div class="card">
                    <h2>üìä Vis√£o Geral</h2>
                    <div class="overview-grid">
                        <div class="overview-item">
                            <strong>Sistema:</strong> MySQL 8.0
                        </div>
                        <div class="overview-item">
                            <strong>Configura√ß√£o:</strong> Docker Container
                        </div>
                        <div class="overview-item">
                            <strong>Conex√£o:</strong> DB_CONNECTION=mysql
                        </div>
                        <div class="overview-item">
                            <strong>Charset:</strong> utf8mb4_unicode_ci
                        </div>
                    </div>
                </div>

                <!-- Arquitetura do Banco -->
                <div class="card">
                    <h2>üèóÔ∏è Arquitetura do Banco</h2>
                    
                    <h3>Estat√≠sticas Atuais</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number">12</span>
                            <span class="stat-label">tabelas implementadas</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">11</span>
                            <span class="stat-label">models Eloquent ativos</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">34</span>
                            <span class="stat-label">varia√ß√µes cadastradas</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">7</span>
                            <span class="stat-label">produtos com dados completos</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">6</span>
                            <span class="stat-label">categorias organizadas</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">4</span>
                            <span class="stat-label">fornecedores para dropshipping</span>
                        </div>
                    </div>

                    <h3>Configura√ß√£o Docker</h3>
                    <div class="code-block">
                        <pre><code># docker-compose.yml
db:
  image: mysql:8.0
  container_name: vibegarb_db
  environment:
    MYSQL_DATABASE: vibegarb
    MYSQL_ROOT_PASSWORD: root
    MYSQL_PASSWORD: vibegarb123
    MYSQL_USER: vibegarb
  ports:
    - "3350:3306"</code></pre>
                    </div>

                    <h3>Configura√ß√£o Laravel</h3>
                    <div class="code-block">
                        <pre><code># .env
DB_CONNECTION=mysql
DB_HOST=db
DB_PORT=3306
DB_DATABASE=vibegarb
DB_USERNAME=vibegarb
DB_PASSWORD=vibegarb123</code></pre>
                    </div>
                </div>

                <!-- Estrutura das Tabelas -->
                <div class="card">
                    <h2>üìã Estrutura das Tabelas</h2>
                    
                    <h3>1. users - Usu√°rios do Sistema</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    birth_date DATE,
    role ENUM('customer', 'admin') DEFAULT 'customer',
    address TEXT,
    city VARCHAR(100),
    state VARCHAR(2),
    zip_code VARCHAR(10),
    email_verified_at TIMESTAMP NULL,
    remember_token VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);</code></pre>
                        </div>
                        <p><strong>√çndices:</strong> email (unique), role</p>
                        <p><strong>Dados:</strong> 3 usu√°rios (1 admin, 2 clientes)</p>
                    </div>

                    <h3>2. categories - Categorias de Produtos</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) UNIQUE NOT NULL,
    description TEXT,
    image VARCHAR(255),
    parent_id BIGINT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE SET NULL
);</code></pre>
                        </div>
                        <p><strong>√çndices:</strong> slug (unique), parent_id, is_active</p>
                        <p><strong>Dados:</strong> 6 categorias ativas</p>
                    </div>

                    <h3>3. suppliers - Fornecedores Dropshipping</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE suppliers (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    company_name VARCHAR(255),
    email VARCHAR(255),
    phone VARCHAR(20),
    address TEXT,
    commission_rate DECIMAL(5,2) DEFAULT 0.00,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);</code></pre>
                        </div>
                        <p><strong>Dados:</strong> 4 fornecedores ativos</p>
                    </div>

                    <h3>4. products - Produtos Principais</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE products (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) UNIQUE NOT NULL,
    description TEXT,
    short_description TEXT,
    sku VARCHAR(100) UNIQUE NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    sale_price DECIMAL(10,2) NULL,
    category_id BIGINT NOT NULL,
    supplier_id BIGINT NOT NULL,
    quality_line ENUM('premium', 'standard', 'basic') DEFAULT 'standard',
    target_audience ENUM('masculino', 'feminino', 'unissex') DEFAULT 'unissex',
    weight DECIMAL(8,2),
    dimensions JSON,
    manage_stock BOOLEAN DEFAULT TRUE,
    stock_quantity INT DEFAULT 0,
    min_stock_level INT DEFAULT 5,
    is_active BOOLEAN DEFAULT TRUE,
    is_featured BOOLEAN DEFAULT FALSE,
    meta_title VARCHAR(255),
    meta_description TEXT,
    images JSON,
    attributes JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);</code></pre>
                        </div>
                        <p><strong>√çndices:</strong> slug (unique), sku (unique), category_id, supplier_id, is_active, is_featured</p>
                        <p><strong>Dados:</strong> 7 produtos com varia√ß√µes completas</p>
                    </div>

                    <h3>5. product_variants - Varia√ß√µes de Produtos</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE product_variants (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT NOT NULL,
    sku VARCHAR(100) UNIQUE NOT NULL,
    size VARCHAR(10),
    color VARCHAR(50),
    price DECIMAL(10,2),
    stock_quantity INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
);</code></pre>
                        </div>
                        <p><strong>√çndices:</strong> sku (unique), product_id, is_active</p>
                        <p><strong>Dados:</strong> 34 varia√ß√µes (P, M, G, GG para cada produto)</p>
                    </div>

                    <h3>6. product_images - Imagens dos Produtos</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE product_images (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT NOT NULL,
    image_path VARCHAR(255) NOT NULL,
    alt_text VARCHAR(255),
    sort_order INT DEFAULT 0,
    is_primary BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
);</code></pre>
                        </div>
                        <p><strong>Estrutura:</strong> Pronta para m√∫ltiplas imagens por produto</p>
                    </div>

                    <h3>7. cart_items - Itens do Carrinho</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE cart_items (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(255) NOT NULL,
    product_id BIGINT NOT NULL,
    product_variant_id BIGINT,
    quantity INT NOT NULL DEFAULT 1,
    price DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (product_variant_id) REFERENCES product_variants(id) ON DELETE CASCADE
);</code></pre>
                        </div>
                        <p><strong>√çndices:</strong> session_id, product_id</p>
                        <p><strong>Funcionalidade:</strong> Carrinho persistente por sess√£o</p>
                    </div>

                    <h3>8. orders - Pedidos</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered', 'cancelled') DEFAULT 'pending',
    total_amount DECIMAL(10,2) NOT NULL,
    shipping_amount DECIMAL(10,2) DEFAULT 0.00,
    discount_amount DECIMAL(10,2) DEFAULT 0.00,
    coupon_id BIGINT NULL,
    shipping_address JSON NOT NULL,
    billing_address JSON,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE SET NULL
);</code></pre>
                        </div>
                        <p><strong>Estrutura:</strong> Pronta para processamento de pedidos</p>
                    </div>

                    <h3>9. order_items - Itens dos Pedidos</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE order_items (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    product_variant_id BIGINT,
    quantity INT NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    total DECIMAL(10,2) NOT NULL,
    product_snapshot JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id),
    FOREIGN KEY (product_variant_id) REFERENCES product_variants(id)
);</code></pre>
                        </div>
                    </div>

                    <h3>10. payments - Pagamentos</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE payments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_id BIGINT NOT NULL,
    payment_method ENUM('pix', 'credit_card', 'debit_card', 'boleto', 'paypal') NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    status ENUM('pending', 'completed', 'failed', 'refunded') DEFAULT 'pending',
    gateway VARCHAR(50),
    transaction_id VARCHAR(255),
    gateway_response JSON,
    paid_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE
);</code></pre>
                        </div>
                    </div>

                    <h3>11. coupons - Cupons de Desconto</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(50) UNIQUE NOT NULL,
    type ENUM('percentage', 'fixed') NOT NULL,
    value DECIMAL(10,2) NOT NULL,
    minimum_amount DECIMAL(10,2) DEFAULT 0.00,
    usage_limit INT NULL,
    used_count INT DEFAULT 0,
    expires_at TIMESTAMP NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);</code></pre>
                        </div>
                    </div>

                    <h3>12. product_reviews - Avalia√ß√µes</h3>
                    <div class="table-structure">
                        <div class="code-block">
                            <pre><code>CREATE TABLE product_reviews (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    order_id BIGINT,
    rating INT NOT NULL CHECK (rating >= 1 AND rating <= 5),
    title VARCHAR(255),
    comment TEXT,
    is_verified BOOLEAN DEFAULT FALSE,
    is_approved BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE SET NULL
);</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Relacionamentos Implementados -->
                <div class="card">
                    <h2>üîÑ Relacionamentos Implementados</h2>
                    
                    <h3>Relacionamentos 1:N</h3>
                    <div class="relationships">
                        <div class="relationship-item">
                            <code>users ‚Üí orders (1:N)</code>
                        </div>
                        <div class="relationship-item">
                            <code>categories ‚Üí products (1:N)</code>
                        </div>
                        <div class="relationship-item">
                            <code>suppliers ‚Üí products (1:N)</code>
                        </div>
                        <div class="relationship-item">
                            <code>products ‚Üí product_variants (1:N)</code>
                        </div>
                        <div class="relationship-item">
                            <code>products ‚Üí product_images (1:N)</code>
                        </div>
                        <div class="relationship-item">
                            <code>orders ‚Üí order_items (1:N)</code>
                        </div>
                        <div class="relationship-item">
                            <code>orders ‚Üí payments (1:N)</code>
                        </div>
                    </div>

                    <h3>Relacionamentos N:M</h3>
                    <div class="relationships">
                        <div class="relationship-item">
                            <code>products ‚Üî cart_items (via session)</code>
                        </div>
                        <div class="relationship-item">
                            <code>users ‚Üî products (via product_reviews)</code>
                        </div>
                    </div>

                    <h3>Relacionamentos Polim√≥rficos</h3>
                    <ul>
                        <li>Preparado para newsletter_subscriptions</li>
                    </ul>
                </div>

                <!-- Dados de Seed Implementados -->
                <div class="card">
                    <h2>üìä Dados de Seed Implementados</h2>
                    
                    <h3>Categorias (6)</h3>
                    <ol>
                        <li>Camisetas B√°sicas</li>
                        <li>Camisetas Premium</li>
                        <li>Edi√ß√µes Limitadas</li>
                        <li>Camisetas Oversized</li>
                        <li>Linha Feminina</li>
                        <li>Linha Masculina</li>
                    </ol>

                    <h3>Produtos (7)</h3>
                    <ul>
                        <li>Cada produto tem 4-6 varia√ß√µes de tamanho</li>
                        <li>Pre√ßos de R$ 39,90 a R$ 89,90</li>
                        <li>Diferentes linhas de qualidade</li>
                        <li>SKUs √∫nicos gerados automaticamente</li>
                    </ul>

                    <h3>Usu√°rios (3)</h3>
                    <ul>
                        <li>1 administrador (admin@vibegarb.com)</li>
                        <li>2 clientes de teste</li>
                        <li>Senhas hasheadas com bcrypt</li>
                    </ul>

                    <h3>Fornecedores (4)</h3>
                    <ul>
                        <li>Dados completos com comiss√µes</li>
                        <li>Endere√ßos e contatos</li>
                        <li>Taxas de comiss√£o configuradas</li>
                    </ul>
                </div>

                <!-- Comandos √öteis -->
                <div class="card">
                    <h2>üîß Comandos √öteis</h2>
                    
                    <h3>Conex√£o ao Banco</h3>
                    <div class="code-block">
                        <pre><code># Via Docker
docker exec -it vibegarb_db mysql -u vibegarb -p vibegarb

# Via Laravel Tinker
docker exec -it vibegarb_app php artisan tinker</code></pre>
                    </div>

                    <h3>Migrations</h3>
                    <div class="code-block">
                        <pre><code># Executar migrations
docker exec vibegarb_app php artisan migrate

# Reset completo
docker exec vibegarb_app php artisan migrate:fresh --seed

# Status das migrations
docker exec vibegarb_app php artisan migrate:status</code></pre>
                    </div>

                    <h3>Seeders</h3>
                    <div class="code-block">
                        <pre><code># Executar todos os seeders
docker exec vibegarb_app php artisan db:seed

# Seeder espec√≠fico
docker exec vibegarb_app php artisan db:seed --class=ProductSeeder</code></pre>
                    </div>

                    <h3>Backup e Restore</h3>
                    <div class="code-block">
                        <pre><code># Backup
docker exec vibegarb_db mysqldump -u vibegarb -p vibegarb > backup.sql

# Restore
docker exec -i vibegarb_db mysql -u vibegarb -p vibegarb < backup.sql</code></pre>
                    </div>
                </div>

                <!-- Seguran√ßa e Performance -->
                <div class="card">
                    <h2>üîí Seguran√ßa e Performance</h2>
                    
                    <h3>√çndices Otimizados</h3>
                    <ul>
                        <li>Primary keys em todas as tabelas</li>
                        <li>Foreign keys com √≠ndices autom√°ticos</li>
                        <li>Unique constraints para campos cr√≠ticos</li>
                        <li>√çndices compostos onde necess√°rio</li>
                    </ul>

                    <h3>Valida√ß√µes</h3>
                    <ul>
                        <li>CHECK constraints para ratings</li>
                        <li>ENUM types para campos limitados</li>
                        <li>NOT NULL para campos obrigat√≥rios</li>
                        <li>Unique constraints para evitar duplicatas</li>
                    </ul>

                    <h3>Configura√ß√µes MySQL</h3>
                    <div class="code-block">
                        <pre><code># my.cnf otimiza√ß√µes
innodb_buffer_pool_size = 256M
max_connections = 100
query_cache_size = 64M
query_cache_type = 1</code></pre>
                    </div>
                </div>

                <!-- Estat√≠sticas Finais -->
                <div class="card">
                    <h2>üìä Estat√≠sticas Atuais</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number">~50</span>
                            <span class="stat-label">registros totais</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">~2MB</span>
                            <span class="stat-label">tamanho do banco</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">< 50ms</span>
                            <span class="stat-label">performance consultas</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">100%</span>
                            <span class="stat-label">integridade consistente</span>
                        </div>
                    </div>
                </div>

                <!-- Conclus√£o -->
                <div class="card conclusion">
                    <h2>‚úÖ Banco de Dados Implementado com Sucesso</h2>
                    <p><em>üìù √öltima atualiza√ß√£o: Julho 2025</em></p>
                    <p><em>üîß Pr√≥xima vers√£o: Implementa√ß√£o completa de pedidos e pagamentos</em></p>
                </div>
            </div>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html> 