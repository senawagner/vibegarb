<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitetura - Vibe Garb E-commerce</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>📚 Documentação</h2>
                <p>Vibe Garb E-commerce</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="index.html">🏠 Início</a></li>
                    <li><a href="architecture.html" class="active">🏗️ Arquitetura</a></li>
                    <li><a href="database.html">🗄️ Banco de Dados</a></li>
                    <li><a href="development.html">🚀 Desenvolvimento</a></li>
                    <li><a href="build.html">🔨 Sistema de Build</a></li>
                    <li><a href="checkout-implementation.html">💳 Checkout</a></li>
                    <li><a href="current-status.html">📊 Status Atual</a></li>
                    <li><a href="mvp-plan.html">📋 Plano MVP</a></li>
                    <li><a href="mvp-migrations.html">🔧 Migrações MVP</a></li>
                    <li><a href="troubleshooting.html">🛠️ Troubleshooting</a></li>
                    <li><a href="session-implementations.html">📝 Implementações</a></li>
                    <li><a href="dropshipping-model.html">📦 Modelo Dropshipping</a></li>
                    <li><a href="git-workflow.html">🔄 Git Workflow</a></li>
                    <li><a href="safe-development.html">🛡️ Desenvolvimento Seguro</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>🏗️ Arquitetura</h1>
                <p class="subtitle">Documentação técnica completa da arquitetura do Vibe Garb E-commerce. Este documento detalha os padrões arquiteturais implementados, stack tecnológica, camadas da aplicação, estrutura de dados, padrões de design utilizados e estratégias de performance. Fundamental para entender a base técnica sólida que sustenta todo o sistema de e-commerce com dropshipping.</p>
                <p class="date">Atualizado: 07/07/2025 - Arquitetura v1.0.0</p>
            </header>

            <div class="content-grid">
                <!-- Visão Geral Arquitetural -->
                <div class="card">
                    <h2>🎯 Visão Geral Arquitetural</h2>
                    <p><strong>Paradigma:</strong> Arquitetura Monolítica Modular com padrão MVC</p>
                    <p><strong>Filosofia:</strong> Convention over Configuration (Laravel)</p>
                    <p><strong>Modelo de Negócio:</strong> E-commerce B2C com Dropshipping</p>
                    
                    <h3>Princípios Arquiteturais</h3>
                    <div class="principle-list">
                        <div class="principle-item">
                            <strong>Separation of Concerns:</strong> Responsabilidades claramente divididas por camadas
                        </div>
                        <div class="principle-item">
                            <strong>Single Responsibility:</strong> Cada classe/model tem uma responsabilidade específica
                        </div>
                        <div class="principle-item">
                            <strong>Dependency Injection:</strong> Laravel Service Container gerencia dependências
                        </div>
                        <div class="principle-item">
                            <strong>SOLID Principles:</strong> Aplicados através dos padrões do Laravel
                        </div>
                        <div class="principle-item">
                            <strong>Convention over Configuration:</strong> Reduz complexidade através de convenções
                        </div>
                    </div>
                </div>

                <!-- Arquitetura em Camadas -->
                <div class="card">
                    <h2>🏢 Arquitetura em Camadas</h2>
                    <h3>Padrão MVC com Camadas Especializadas</h3>
                    <div class="architecture-diagram">
                        <div class="layer">
                            <h4>🎨 PRESENTATION LAYER</h4>
                            <ul>
                                <li>🌐 <strong>Blade Templates:</strong> Server-side rendering para SEO otimizado</li>
                                <li>🎯 <strong>Controllers:</strong> Lógica de apresentação e fluxo de dados</li>
                                <li>🔒 <strong>Middleware:</strong> Interceptação de requests (auth, cors, etc.)</li>
                                <li>📡 <strong>Routes:</strong> Mapeamento de URLs para controllers</li>
                                <li>✅ <strong>Form Requests:</strong> Validação de entrada estruturada</li>
                            </ul>
                        </div>
                        <div class="layer">
                            <h4>🧠 BUSINESS LOGIC LAYER</h4>
                            <ul>
                                <li>⚙️ <strong>Services:</strong> Lógica de negócio complexa (CartService, OrderCreationService)</li>
                                <li>🔧 <strong>Models:</strong> Entidades de domínio com relacionamentos</li>
                                <li>🔍 <strong>Scopes:</strong> Queries reutilizáveis e otimizadas</li>
                                <li>🎭 <strong>Accessors/Mutators:</strong> Transformação de dados transparente</li>
                                <li>🔄 <strong>Events/Listeners:</strong> Comunicação assíncrona entre módulos</li>
                            </ul>
                        </div>
                        <div class="layer">
                            <h4>🗄️ DATA ACCESS LAYER</h4>
                            <ul>
                                <li>🔗 <strong>Eloquent ORM:</strong> Abstração de banco com Active Record</li>
                                <li>📊 <strong>Query Builder:</strong> Construção de queries complexas</li>
                                <li>🏗️ <strong>Migrations:</strong> Versionamento de estrutura de dados</li>
                                <li>🌱 <strong>Seeders:</strong> Dados iniciais e testes automatizados</li>
                                <li>🏭 <strong>Factories:</strong> Geração de dados de teste</li>
                            </ul>
                        </div>
                        <div class="layer">
                            <h4>🐳 INFRASTRUCTURE LAYER</h4>
                            <ul>
                                <li>🐳 <strong>Docker:</strong> Containerização e isolamento de ambiente</li>
                                <li>🌐 <strong>Nginx:</strong> Proxy reverso e servidor web otimizado</li>
                                <li>⚡ <strong>Redis:</strong> Cache em memória e gerenciamento de sessões</li>
                                <li>🗄️ <strong>MySQL:</strong> Banco relacional com otimizações InnoDB</li>
                                <li>📝 <strong>Logs:</strong> Monitoramento e debugging centralizado</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Stack Tecnológica -->
                <div class="card">
                    <h2>🔧 Stack Tecnológica Detalhada</h2>
                    <div class="tech-grid">
                        <div class="tech-section">
                            <h3>Backend Core</h3>
                            <ul>
                                <li><strong>PHP 8.2:</strong> Performance, typed properties, match expressions</li>
                                <li><strong>Laravel 12.19.3:</strong> Framework moderno com DI container</li>
                                <li><strong>Eloquent ORM:</strong> Active Record com eager loading</li>
                                <li><strong>Laravel Breeze:</strong> Autenticação session-based simplificada</li>
                                <li><strong>Sanctum:</strong> API token authentication (preparado)</li>
                                <li><strong>Telescope:</strong> Debug e profiling (desenvolvimento)</li>
                            </ul>
                        </div>
                        <div class="tech-section">
                            <h3>Infraestrutura</h3>
                            <ul>
                                <li><strong>Docker Compose:</strong> Orquestração multi-container</li>
                                <li><strong>Nginx 1.27:</strong> Load balancing e SSL termination</li>
                                <li><strong>PHP-FPM:</strong> Process manager otimizado</li>
                                <li><strong>MySQL 8.0:</strong> JSON support, Window functions, CTEs</li>
                                <li><strong>Redis 7:</strong> Modules, Streams, JSON support</li>
                                <li><strong>Node.js 18:</strong> Build tools e asset compilation</li>
                            </ul>
                        </div>
                        <div class="tech-section">
                            <h3>Frontend & Assets</h3>
                            <ul>
                                <li><strong>Blade Templates:</strong> Server-side rendering com componentes</li>
                                <li><strong>Tailwind CSS 3.x:</strong> Utility-first CSS framework</li>
                                <li><strong>Alpine.js:</strong> JavaScript reativo minimalista (onde necessário)</li>
                                <li><strong>Vite 5.x:</strong> Build tool com HMR e bundling otimizado</li>
                                <li><strong>PostCSS:</strong> Transformações CSS automatizadas</li>
                                <li><strong>Vanilla JS:</strong> JavaScript nativo para performance máxima</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Camada de Dados -->
                <div class="card">
                    <h2>🗄️ Arquitetura de Dados</h2>
                    <h3>Modelo Relacional Otimizado para E-commerce</h3>
                    <div class="data-architecture">
                        <div class="entity-group">
                            <h4>Entidades Core</h4>
                            <ul>
                                <li><strong>Users:</strong> Clientes e administradores com roles</li>
                                <li><strong>Categories:</strong> Hierarquia de produtos com slugs SEO</li>
                                <li><strong>Suppliers:</strong> Fornecedores para dropshipping</li>
                                <li><strong>Products:</strong> Catálogo com variações e preços dinâmicos</li>
                            </ul>
                        </div>
                        
                        <div class="entity-group">
                            <h4>Sistema de Produtos</h4>
                            <ul>
                                <li><strong>Product Images:</strong> Múltiplas imagens com ordenação</li>
                                <li><strong>Product Variants:</strong> Cores, tamanhos e preços adicionais</li>
                                <li><strong>Product Reviews:</strong> Avaliações verificadas por compra</li>
                                <li><strong>Cart Items:</strong> Carrinho persistente com sessões</li>
                            </ul>
                        </div>
                        
                        <div class="entity-group">
                            <h4>Sistema de Pedidos</h4>
                            <ul>
                                <li><strong>Orders:</strong> Pedidos com checkout anônimo suportado</li>
                                <li><strong>Order Items:</strong> Snapshot de preços no momento da compra</li>
                                <li><strong>Payments:</strong> Multi-gateway com webhooks</li>
                                <li><strong>Coupons:</strong> Sistema de desconto flexível</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Estratégias de Relacionamento</h3>
                    <div class="relationship-strategies">
                        <div class="strategy-item">
                            <strong>One-to-Many:</strong> Users→Orders, Products→Variants, Categories→Products
                        </div>
                        <div class="strategy-item">
                            <strong>Many-to-Many:</strong> Orders→Products (via OrderItems com pivot data)
                        </div>
                        <div class="strategy-item">
                            <strong>Polymorphic:</strong> Reviews (preparado para produtos e pedidos)
                        </div>
                        <div class="strategy-item">
                            <strong>Nullable FKs:</strong> Orders.user_id para checkout anônimo
                        </div>
                    </div>
                </div>

                <!-- Padrões de Design -->
                <div class="card">
                    <h2>🔄 Padrões de Design Implementados</h2>
                    
                    <h3>Repository Pattern (via Eloquent)</h3>
                    <div class="code-block">
                        <pre><code>// Abstração de acesso a dados com Eloquent
class Product extends Model 
{
    // Relacionamentos tipados
    public function category(): BelongsTo 
    {
        return $this->belongsTo(Category::class);
    }
    
    // Scopes para queries reutilizáveis
    public function scopeActive($query): Builder 
    {
        return $query->where('is_active', true);
    }
    
    // Business logic encapsulada
    public function getCurrentPriceAttribute(): float 
    {
        return $this->sale_price ?? $this->price;
    }
}</code></pre>
                    </div>

                    <h3>Service Layer Pattern</h3>
                    <div class="code-block">
                        <pre><code>// Lógica de negócio complexa isolada
class CartService 
{
    public function addItem(Product $product, array $options): void
    {
        // Validações de negócio
        // Cálculos de preço
        // Persistência de estado
    }
    
    public function calculateTotals(): array
    {
        // Lógica complexa de cálculo
        // Aplicação de descontos
        // Cálculo de frete
    }
}</code></pre>
                    </div>

                    <h3>Observer Pattern (Laravel Events)</h3>
                    <div class="code-block">
                        <pre><code>// Eventos automáticos do modelo
class Order extends Model 
{
    protected static function boot(): void
    {
        parent::boot();
        
        static::creating(function ($order) {
            $order->order_number = self::generateOrderNumber();
        });
        
        static::updated(function ($order) {
            if ($order->isDirty('status')) {
                event(new OrderStatusChanged($order));
            }
        });
    }
}</code></pre>
                    </div>

                    <h3>Factory Pattern (Seeders & Testing)</h3>
                    <div class="code-block">
                        <pre><code>// Criação consistente de objetos complexos
class ProductFactory extends Factory
{
    protected $model = Product::class;
    
    public function definition(): array
    {
        return [
            'name' => $this->faker->words(3, true),
            'price' => $this->faker->randomFloat(2, 10, 200),
            'quality_line' => $this->faker->randomElement([
                'classic', 'quality', 'prime', 'pima'
            ]),
        ];
    }
}</code></pre>
                    </div>
                </div>

                <!-- Segurança -->
                <div class="card">
                    <h2>🔐 Arquitetura de Segurança</h2>
                    
                    <h3>Autenticação & Autorização</h3>
                    <div class="security-grid">
                        <div class="security-item">
                            <h4>Session-based Auth</h4>
                            <ul>
                                <li>Laravel Breeze para UI de autenticação</li>
                                <li>CSRF protection automático</li>
                                <li>Password hashing com bcrypt</li>
                                <li>Session hijacking protection</li>
                            </ul>
                        </div>
                        <div class="security-item">
                            <h4>API Security (Preparado)</h4>
                            <ul>
                                <li>Laravel Sanctum para API tokens</li>
                                <li>Rate limiting configurado</li>
                                <li>CORS policy definida</li>
                                <li>Token expiration automática</li>
                            </ul>
                        </div>
                        <div class="security-item">
                            <h4>Data Protection</h4>
                            <ul>
                                <li>Mass assignment protection</li>
                                <li>SQL injection prevention (Eloquent)</li>
                                <li>XSS protection (Blade escaping)</li>
                                <li>Sensitive data masking</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Validation & Sanitization</h3>
                    <div class="code-block">
                        <pre><code>// Form Request para validação estruturada
class ProcessCheckoutRequest extends FormRequest
{
    public function rules(): array
    {
        return [
            'customer_name' => 'required|string|max:255',
            'customer_email' => 'required|email|max:255',
            'customer_phone' => 'required|string|regex:/^\(\d{2}\)\s\d{4,5}-\d{4}$/',
            'shipping_zipcode' => 'required|string|regex:/^\d{5}-?\d{3}$/',
            'payment_method' => 'required|in:pix,boleto,credit_card',
        ];
    }
}</code></pre>
                    </div>
                </div>

                <!-- Performance & Escalabilidade -->
                <div class="card">
                    <h2>🚀 Performance & Escalabilidade</h2>
                    
                    <h3>Estratégias de Cache</h3>
                    <div class="cache-strategies">
                        <div class="cache-item">
                            <h4>Application Cache (Redis)</h4>
                            <ul>
                                <li>Query result caching para consultas pesadas</li>
                                <li>Session storage distribuído</li>
                                <li>View fragment caching</li>
                                <li>Rate limiting storage</li>
                            </ul>
                        </div>
                        <div class="cache-item">
                            <h4>Database Optimization</h4>
                            <ul>
                                <li>Índices estratégicos em foreign keys</li>
                                <li>Eager loading para N+1 prevention</li>
                                <li>Query scopes para reutilização</li>
                                <li>Connection pooling via Docker</li>
                            </ul>
                        </div>
                        <div class="cache-item">
                            <h4>Asset Optimization</h4>
                            <ul>
                                <li>Vite bundling e tree-shaking</li>
                                <li>CSS purging com Tailwind</li>
                                <li>Image lazy loading</li>
                                <li>Resource versioning automático</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Horizontal Scaling (Preparado)</h3>
                    <div class="scaling-strategies">
                        <div class="scaling-item">
                            <strong>Load Balancing:</strong> Nginx configurado para múltiplas instâncias PHP-FPM
                        </div>
                        <div class="scaling-item">
                            <strong>Database Replication:</strong> Master-slave setup preparado para read scaling
                        </div>
                        <div class="scaling-item">
                            <strong>Redis Clustering:</strong> Distributed cache para múltiplos servidores
                        </div>
                        <div class="scaling-item">
                            <strong>CDN Integration:</strong> Asset delivery via CloudFlare (preparado)
                        </div>
                    </div>
                </div>

                <!-- Integração e APIs -->
                <div class="card">
                    <h2>🔌 Arquitetura de Integração</h2>
                    
                    <h3>API Architecture (RESTful)</h3>
                    <div class="api-structure">
                        <div class="api-layer">
                            <h4>Resource Controllers</h4>
                            <ul>
                                <li>Endpoints RESTful padronizados</li>
                                <li>JSON response formatting</li>
                                <li>Error handling consistente</li>
                                <li>API versioning preparado</li>
                            </ul>
                        </div>
                        <div class="api-layer">
                            <h4>Authentication Layer</h4>
                            <ul>
                                <li>Sanctum token management</li>
                                <li>Scoped permissions</li>
                                <li>Rate limiting per endpoint</li>
                                <li>CORS configuration</li>
                            </ul>
                        </div>
                    </div>

                    <h3>External Integrations</h3>
                    <div class="integration-grid">
                        <div class="integration-item">
                            <h4>Payment Gateways</h4>
                            <p>Multi-gateway architecture preparada para:</p>
                            <ul>
                                <li>Mercado Pago (PIX, Cartão, Boleto)</li>
                                <li>Stripe (Cartão internacional)</li>
                                <li>PayPal (Carteira digital)</li>
                                <li>PagSeguro (Alternativo nacional)</li>
                            </ul>
                        </div>
                        <div class="integration-item">
                            <h4>Correios API</h4>
                            <p>Integração para logística:</p>
                            <ul>
                                <li>Cálculo de frete em tempo real</li>
                                <li>Validação de CEP</li>
                                <li>Rastreamento de pedidos</li>
                                <li>Prazo de entrega estimado</li>
                            </ul>
                        </div>
                        <div class="integration-item">
                            <h4>Dimona API</h4>
                            <p>Dropshipping automation:</p>
                            <ul>
                                <li>Envio automático de pedidos</li>
                                <li>Webhook status updates</li>
                                <li>Tracking code integration</li>
                                <li>Product sync automation</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Monitoramento -->
                <div class="card">
                    <h2>📊 Arquitetura de Monitoramento</h2>
                    
                    <h3>Logging Strategy</h3>
                    <div class="logging-levels">
                        <div class="log-level">
                            <strong>ERROR:</strong> Falhas críticas, exceptions não tratadas
                        </div>
                        <div class="log-level">
                            <strong>WARNING:</strong> Problemas recuperáveis, validações falharam
                        </div>
                        <div class="log-level">
                            <strong>INFO:</strong> Business events importantes (pedidos, pagamentos)
                        </div>
                        <div class="log-level">
                            <strong>DEBUG:</strong> Detailed execution flow (desenvolvimento apenas)
                        </div>
                    </div>

                    <h3>Metrics Collection (Preparado)</h3>
                    <div class="metrics-types">
                        <div class="metric-type">
                            <h4>Performance Metrics</h4>
                            <ul>
                                <li>Response time por endpoint</li>
                                <li>Database query performance</li>
                                <li>Memory usage patterns</li>
                                <li>Cache hit rates</li>
                            </ul>
                        </div>
                        <div class="metric-type">
                            <h4>Business Metrics</h4>
                            <ul>
                                <li>Conversion rates</li>
                                <li>Cart abandonment</li>
                                <li>Revenue per user</li>
                                <li>Product performance</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Deployment Architecture -->
                <div class="card">
                    <h2>🚀 Arquitetura de Deploy</h2>
                    
                    <h3>Containerização (Docker)</h3>
                    <div class="container-architecture">
                        <div class="container-item">
                            <h4>Application Container</h4>
                            <ul>
                                <li><strong>Base:</strong> PHP 8.2-FPM Alpine</li>
                                <li><strong>Extensions:</strong> PDO, Redis, GD, Zip</li>
                                <li><strong>Process Manager:</strong> PHP-FPM otimizado</li>
                                <li><strong>Health Check:</strong> Endpoint de status</li>
                            </ul>
                        </div>
                        <div class="container-item">
                            <h4>Web Server Container</h4>
                            <ul>
                                <li><strong>Base:</strong> Nginx 1.27 Alpine</li>
                                <li><strong>Configuration:</strong> Optimized for Laravel</li>
                                <li><strong>SSL:</strong> TLS 1.3 support</li>
                                <li><strong>Compression:</strong> Gzip enabled</li>
                            </ul>
                        </div>
                        <div class="container-item">
                            <h4>Database Container</h4>
                            <ul>
                                <li><strong>Engine:</strong> MySQL 8.0</li>
                                <li><strong>Storage:</strong> InnoDB optimized</li>
                                <li><strong>Charset:</strong> utf8mb4_unicode_ci</li>
                                <li><strong>Backup:</strong> Volume persistence</li>
                            </ul>
                        </div>
                        <div class="container-item">
                            <h4>Cache Container</h4>
                            <ul>
                                <li><strong>Engine:</strong> Redis 7 Alpine</li>
                                <li><strong>Persistence:</strong> RDB + AOF</li>
                                <li><strong>Memory:</strong> Optimized eviction</li>
                                <li><strong>Clustering:</strong> Ready for scale</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Production Deployment (cPanel Ready)</h3>
                    <div class="deployment-strategy">
                        <div class="deploy-phase">
                            <h4>Build Phase</h4>
                            <ul>
                                <li>Composer install (optimized)</li>
                                <li>NPM build (production assets)</li>
                                <li>Laravel optimization (config, routes, views cache)</li>
                                <li>Asset versioning e CDN prep</li>
                            </ul>
                        </div>
                        <div class="deploy-phase">
                            <h4>Deploy Phase</h4>
                            <ul>
                                <li>Zero-downtime deployment</li>
                                <li>Database migrations automáticas</li>
                                <li>SSL certificate automation</li>
                                <li>Health check validation</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Considerações Futuras -->
                <div class="card conclusion">
                    <h2>🔮 Considerações Arquiteturais Futuras</h2>
                    
                    <h3>Evolução Arquitetural</h3>
                    <div class="evolution-path">
                        <div class="evolution-stage">
                            <h4>Microservices (Longo Prazo)</h4>
                            <ul>
                                <li>Separação de domínios (Products, Orders, Users)</li>
                                <li>Event-driven communication</li>
                                <li>Distributed database per service</li>
                                <li>API Gateway implementation</li>
                            </ul>
                        </div>
                        <div class="evolution-stage">
                            <h4>Cloud Native (Médio Prazo)</h4>
                            <ul>
                                <li>Kubernetes orchestration</li>
                                <li>Serverless functions para operações específicas</li>
                                <li>Managed databases (RDS, ElastiCache)</li>
                                <li>Auto-scaling baseado em métricas</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Performance Otimizations</h3>
                    <ul>
                        <li>🎯 <strong>CQRS Pattern:</strong> Para separar reads/writes complexos</li>
                        <li>🎯 <strong>Event Sourcing:</strong> Para auditoria completa de pedidos</li>
                        <li>🎯 <strong>GraphQL API:</strong> Para client applications específicas</li>
                        <li>🎯 <strong>Redis Streams:</strong> Para real-time notifications</li>
                    </ul>

                    <h3>Status Arquitetural Atual</h3>
                    <p><strong>🟢 ARQUITETURA SÓLIDA:</strong> Base técnica robusta e escalável implementada com padrões industry-standard.</p>
                    <p><strong>🎯 PRONTO PARA CRESCIMENTO:</strong> Estrutura preparada para evolução incremental sem rupturas.</p>
                    <p><strong>🚀 PRODUCTION READY:</strong> Arquitetura validada e otimizada para ambiente de produção.</p>
                </div>
            </div>
        </main>
    </div>
</body>
</html> 